{{ if and (eq .chezmoi.os "windows") (not .headless) -}}
function Check-Package-Installation {
    param(
        [Parameter(Mandatory)][string]$package
    )

    # check package installation
    winget list $package | Out-Null
    if ($LastExitCode -ne 0) {
        return 0
    } else {
        Write-Host $package has already installed
        return 1
    }
}

# Install Git via winget
if ((Check-Package-Installation('git.git')) -eq 0) {
    # Create INF file for Git
    Write-Output @"
[Setup]
Lang=default
Dir=C:\Program Files\Git
Group=Git
NoIcons=0
SetupType=default
Components=gitlfs,assoc,assoc_sh,windowsterminal,scalar
Tasks=
EditorOption=VIM
CustomEditorPath=
DefaultBranchOption=main
PathOption=Cmd
SSHOption=OpenSSH
TortoiseOption=false
CURLOption=OpenSSL
CRLFOption=CRLFCommitAsIs
BashTerminalOption=MinTTY
GitPullBehaviorOption=Merge
UseCredentialManager=Enabled
PerformanceTweaksFSCache=Enabled
EnableSymlinks=Disabled
EnablePseudoConsoleSupport=Disabled
EnableFSMonitor=Disabled
"@ > $env:TEMP\git-git.inf

    winget install git.git --override "/VERYSILENT /LOADINF=$env:TEMP\git-git.inf"

    # Delete INF file for Git
    Remove-Item -Path $env:TEMP\git-git.inf
}

# Install Package via winget
$packages =@(
    '7zip.7zip',
    'AgileBits.1Password',
    'Discord.Discord',
    'Dropbox.Dropbox',
    'Google.JapaneseIME',
    'LINE.LINE',
    'Microsoft.VisualStudioCode',
    'Microsoft.WindowsTerminal',
    'Mozilla.Thunderbird',
    'Notion.Notion',
    'Obsidian.Obsidian',
    'SlackTechnologies.Slack',
    'tailscale.tailscale',
    'Valve.Steam',
    #'VivaldiTechnologies.Vivaldi',
    'wez.wezterm',
    'Zoom.Zoom'
)

foreach ( $package in $packages ) {
    if ((Check-Package-Installation($package)) -eq 0) {
        winget install -e --id $package
    }
}
{{ end -}}
