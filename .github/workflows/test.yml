name: test
on:
  push:
permissions:
  contents: read
jobs:
  shellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: .chezmoiscripts
          ignore_paths: .chezmoiscripts/windows
  install:
    strategy:
      matrix:
        os:
          - macos-latest
          - ubuntu-22.04
    runs-on: ${{matrix.os}}
    steps:
      - uses: actions/checkout@v3
      - name: Install
        run: |
          sh -c "$(curl -fsLS get.chezmoi.io)" -- -b ${HOME}/.local/bin init --apply --branch ${GITHUB_REF_NAME} m1yam0t0
          rm -f ${HOME}/.local/bin/chezmoi
  install-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install
        run: |
          Set-ExecutionPolicy RemoteSigned -Scope CurrentUser -Force
          '$params = "-b $HOME/.local/bin init --apply --branch $env:GITHUB_REF_NAME m1yam0t0"', (irm https://get.chezmoi.io/ps1) | powershell -c -
          rm $HOME/.local/bin/chezmoi.exe -Force
